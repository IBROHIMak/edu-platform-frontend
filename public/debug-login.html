<!DOCTYPE html>
<html>
<head>
    <title>Debug Login Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Login Debug Test</h1>
    
    <div class="test-section">
        <h2>1. Test Direct API Calls</h2>
        <button onclick="testDirectAPI()">Test All Direct API</button>
        <div id="direct-api-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Test Frontend Login (Same as React App)</h2>
        <button onclick="testFrontendLogin()">Test Frontend Login</button>
        <div id="frontend-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Network Debug Info</h2>
        <button onclick="showNetworkInfo()">Show Network Info</button>
        <div id="network-info"></div>
    </div>

    <script>
        // Test direct API calls
        async function testDirectAPI() {
            const resultDiv = document.getElementById('direct-api-result');
            resultDiv.innerHTML = '<p>Testing direct API calls...</p>';
            
            const tests = [
                { name: 'Admin', firstName: 'Admin', lastName: 'Boshqaruvchi', password: 'Admin123!@#', role: 'admin' },
                { name: 'Student Ali', firstName: 'Ali', lastName: 'Valiyev', password: 'Password123!', role: 'student' },
                { name: 'Teacher Malika', firstName: 'Malika', lastName: 'Tosheva', password: 'Password123!', role: 'teacher' }
            ];
            
            let results = '';
            
            for (const test of tests) {
                try {
                    const response = await fetch('http://localhost:5004/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            firstName: test.firstName,
                            lastName: test.lastName,
                            password: test.password,
                            role: test.role
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        results += '<p class="success">‚úÖ ' + test.name + ' - SUCCESS</p>';
                        results += '<pre>' + JSON.stringify(data.data.user, null, 2) + '</pre>';
                    } else {
                        results += '<p class="error">‚ùå ' + test.name + ' - FAILED</p>';
                        results += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    }
                } catch (error) {
                    results += '<p class="error">üí• ' + test.name + ' - ERROR: ' + error.message + '</p>';
                }
            }
            
            resultDiv.innerHTML = results;
        }
        
        // Test frontend-style login (mimicking React app)
        async function testFrontendLogin() {
            const resultDiv = document.getElementById('frontend-result');
            resultDiv.innerHTML = '<p>Testing frontend-style login...</p>';
            
            try {
                // Mimic the exact same request as React app
                const credentials = {
                    firstName: 'Ali',
                    lastName: 'Valiyev',
                    password: 'Password123!',
                    role: 'student'
                };
                
                console.log('üîê Login attempt:', credentials);
                
                const response = await fetch('http://localhost:5004/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(credentials)
                });
                
                console.log('üì° Response status:', response.status);
                console.log('üì° Response headers:', response.headers);
                
                const data = await response.json();
                console.log('üì• Response data:', data);
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = '<p class="success">‚úÖ Frontend-style login SUCCESS!</p>';
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    resultDiv.innerHTML = '<p class="error">‚ùå Frontend-style login FAILED!</p>';
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                console.error('üí• Frontend login error:', error);
                resultDiv.innerHTML = '<p class="error">üí• ERROR: ' + error.message + '</p>';
            }
        }
        
        // Show network debug info
        function showNetworkInfo() {
            const resultDiv = document.getElementById('network-info');
            
            const info = {
                'Current URL': window.location.href,
                'User Agent': navigator.userAgent,
                'Backend URL': 'http://localhost:5004',
                'Frontend URL': 'http://localhost:3000',
                'CORS Test': 'Will test CORS...'
            };
            
            let html = '<h3>Network Information:</h3>';
            for (const [key, value] of Object.entries(info)) {
                html += '<p><strong>' + key + ':</strong> ' + value + '</p>';
            }
            
            // Test CORS
            fetch('http://localhost:5004/api/auth/login', {
                method: 'OPTIONS'
            }).then(response => {
                html += '<p><strong>CORS Test:</strong> <span class="success">‚úÖ OK (Status: ' + response.status + ')</span></p>';
                resultDiv.innerHTML = html;
            }).catch(error => {
                html += '<p><strong>CORS Test:</strong> <span class="error">‚ùå FAILED - ' + error.message + '</span></p>';
                resultDiv.innerHTML = html;
            });
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>